# 工作日志

> 日期：2020年9月26日

本周开始，疲于应付项目产生的bug，前期设计书太烂，后期开发者水平参差不齐，懂业务逻辑的还有不懂代码的，管理也是十分混乱。一个项目是否成功代码实现虽然是主要的，但是如果管理混乱，那实现估计也好不到哪去。

## 对象相等判断

老生常谈的问题，关于`Object.equals()`方法是判断对象的值是否是正确的，而**==**是判断引用是否相等，尤其要注意的是`String`类型，一不小心就用错了。但是定义一个类型的时候到底时使用基本类型诸如`int`等还是使用`Integer`等包装类型，这个还是根据项目的实际需求来判断，个人理解区别不是很大，除了泛型的时候只能用包装类型之外，大部分时候两者都是可以互换的。

## 事务

在Spring中使用事务注解@Transactional，该注解标注在一个方法上，然后在这个方法内调用的其他方法都会应用这个事务，这个属于事务的传播性。这周在解决一个问题的时候碰到一个百思不得其解的事情，明明数据库里的记录是A，但是取出来的数据就莫名其妙的变成了C（各位看官看到这应该知道是什么问题了吧），然后就导致了后续的逻辑处理就出错了。一开始调查的方向是是不是Mapper的文件里SQL写的不对，可是想了想基本不可能，项目所有的单表数据都是使用工具自动生成的。后来的想法是可能是Mybaits的一级缓存的原因，简单的调查了一下，好像没什么关系。再后来通过缓存突然联想到，如果使用的事务的话，在一个事务还没有完成之前是不会被提交的。而且我们使用的事务隔离级别是默认的readcommited（单词可能不对？），同一个事务里查询操作总能读取到其他操作更新的数据。

这样问题的原因就一目了然了，因为在前面的操作里更新了某条记录，然后之后的操作里查出这条已经被更新过的记录，因为这条记录还没有被提交到数据库里（事务还没有完成），所以自然数据库没有C这条数据。

## 集合

#### 其一

对于一个Java的项目来说，其实大多数的时候都是跟java.util.*下的集合类库打交道。对于集合类库的使用技巧之类的看文档或者文章之类的基本就明白了。这里单纯写一些使用过程中因为使用方式不恰当而导致的一些问题。比如说Collectors.toMap方法，当你使用他来生成一个map对象的时候，key是不能重复，如果重复了那就会直接报错，但是有意思的是，这个报错只是Java提供的一种默认处理重复key的一种方式，你完全可以提供你想要的处理方式，然后将这种处理重复key的方式传入其中（该方法的第三个参数），然后默认抛出异常的方式就会被替换成你的处理方法。